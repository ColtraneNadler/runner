<!DOCTYPE html>
<html>

<head>
	<title>Runner</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"/>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r119/three.min.js"
		integrity="sha512-E1+SnTWyHYoY5MN8wpL0SI4TYbpWN12sHXyEViwbzzEyq6GHxQrPFDzEeUDab4emXcf3Yj41Tht2JZnpo3kjwA=="
		crossorigin="anonymous"></script>
	<script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/loaders/GLTFLoader.js"></script>
	<script src="https://cdn.rawgit.com/mrdoob/three.js/master/examples/js/loaders/RGBELoader.js"></script>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/stats.js/r16/Stats.min.js"></script>
	<script src="/js/Spawner.js"></script>
	<script src="/js/ConstructionEnv.js"></script>
	<script src="/js/CityEnv.js"></script>
	<script src="/js/ForestEnv.js"></script>
	<link rel="stylesheet" type="text/css" href="/css/style.css">
</head>

<body>
	<!-- DSP -->
	<div id="wrapper">
		<!-- <div id="bkg"></div> -->

		<div id="popup-wrapper" hidden>
			<div id="popup">
				<h4 id="leaderboard-score">SCORE: 15102</h4>
				<br />
				<table>
					<tr>
						<td>LEAH</td>
						<td>15102</td>
					</tr>
					<tr>
						<td>TROY</td>
						<td>12322</td>
					</tr>
				</table>
				<br />
				<button class="btn" onclick="togglePause()">RESUME</button>
			</div>
		</div>


		<!-- landing -->
		<div id="landing">
			<h1>Purpose Pro 2</h1>
			<br />
			<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
			<br /><br /><!-- 
			<button id="play_btn" class="btn" onclick="authApple()">APPLE MUSIC</button>
			<button id="play_btn" class="btn" onclick="authSpotify()">SPOTIFY</button> -->
			<button id="play_btn" class="btn" onclick="auth()">PLAY</button>
		</div>

		<!-- set name -->
		<div id="name" hidden>
			<h3>What's your name?</h3>
			<br />
			<input type="text" id="name-input" placeholder="Enter your name...">
			<br />
			<button class="btn" style="width: 100%" onclick="submitName()">SUBMIT</button>
		</div>

		<!-- select character -->
		<div id="character-select" hidden>
			<h3>Character Select</h3>
			<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
			<button class="outfit-btn" id="outfit-prev" style="margin-right: 5rem"><i class="fa fa-arrow-left"></i></button>
			<button class="outfit-btn" id="outfit-next" style="margin-left: 5rem"><i class="fa fa-arrow-right"></i></button>

			<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
			<button class="btn" onclick="selectCharacter()" style="width: 12rem">NEXT</button>
		</div>

		<!-- select level -->
		<div id="level-select" hidden>
			<h3>LEVEL Select</h3>

			<div style="display: flex; margin-top: 4rem; margin-bottom: 4rem">
				<button class="outfit-btn" id="level-prev"><i class="fa fa-arrow-left"></i></button>
				<div style="background-image: url(/img/env0.jpg)" id="level-image"></div>
				<button class="outfit-btn" id="level-next"><i class="fa fa-arrow-right"></i></button>
			</div>
			<br />
			<button class="btn" onclick="selectLevel()" style="width: 12rem">PLAY</button>
		</div>

		
		<div id="game" hidden>
			<div class="ui">
				<div id="score-wrap" hidden>
					<div id="score-wrapper">
						<span id="score">score: 0</span>
					</div>
					<button id="pause-btn" onclick="togglePause()">
						<i class="fa fa-pause"></i>
					</button>
				</div>

				<p id="sceneTitle" hidden>score: 0</p>
			</div>
		</div>


	<div id="stats" style="position: absolute; top: 0;">
	</div>
</body>
<script type="text/javascript" src="/config/index.js"></script>
<script type="text/javascript" src="/js/tween.js"></script>
<script type="text/javascript" src="/js/game.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WP28MSFMTM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WP28MSFMTM');
</script>
<script type="text/javascript">
window.addScript = link => {
	let tag = document.createElement("script");
	tag.src = link;
	document.getElementsByTagName("head")[0].appendChild(tag);
}
</script>
<script type="text/javascript">
const play = ({
  uris,
  spotify_uri,
  position_ms,
  playerInstance: {
    _options: {
      getOAuthToken,
      id
    }
  }
}) => new Promise((res, rej) => {
  getOAuthToken(access_token => {
    fetch(`https://api.spotify.com/v1/me/player/play?device_id=${id}`, {
      method: 'PUT',
      body: JSON.stringify({ uris, offset: {uri: spotify_uri}, position_ms }),
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${access_token}`
      },
    }).then(response => res())
    .catch(err => console.log('ERROR PLAYING SPOTIFY',err));
  });
});

function initSpotifyWebPlayback(oauth_token, onPlayerReady, onPlayerStateChange) {
	window.onSpotifyWebPlaybackSDKReady = () => {
	  const token = oauth_token;

	  let token_update = Date.now();

	  let spotify_player = new Spotify.Player({
	    name: 'tunecast.com',
	    getOAuthToken: async cb => { 
	    	if(Date.now() - token_update < 1000 * 60 * 60)
	    		return cb(token); 

	    	// fetch token
	    	token_update = Date.now();
	    	cb(token)
	    }
	  });

	  // Error handling
	  spotify_player.addListener('initialization_error', ({ message }) => { console.error('init error', message); });
	  spotify_player.addListener('authentication_error', ({ message }) => { console.error('auth error', message); });
	  spotify_player.addListener('account_error', ({ message }) => { console.error('account error', message); });
	  spotify_player.addListener('playback_error', ({ message }) => { console.error('playback error', message); });

	  // Playback status updates
	  // spotify_player.addListener('player_state_changed', state => { console.log('SPOTIFY STATE',state); });

	  // spotify_player.addListener('player_state_changed', onPlayerStateChange);

	  // Ready
	  spotify_player.addListener('ready', ({ device_id }) => {
	    onPlayerReady(spotify_player);
	  });

	  // Not Ready
	  spotify_player.addListener('not_ready', ({ device_id }) => {
	    console.log('Device ID has gone offline', device_id);
	  });

	  // Connect to the player!
	  spotify_player.connect()
	  .then(() => console.log('successfully connected to spotify connect!'));
	};
}
</script>
</html>